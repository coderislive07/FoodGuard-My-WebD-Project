<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FoodGuard - Reduce Food Waste</title>
    <link rel="stylesheet" href="index.css">
    <style>
        /* Minimal styling for modal */
        .notification-modal {
            display: none;
            position: fixed;
            z-index: 200;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }
        .notification-modal-content {
            background: #fff;
            padding: 1rem 2rem;
            border-radius: 10px;
            max-width: 400px;
            width: 90%;
            max-height: 80%;
            overflow-y: auto;
            position: relative;
        }
        .notification-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }
        .notification-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
            padding: 0.5rem;
            border-bottom: 1px solid #eee;
        }
        .notification-content h4 {
            margin: 0;
            font-size: 1rem;
        }
        .notification-content p {
            margin: 0.2rem 0 0 0;
            font-size: 0.85rem;
            color: #555;
        }
        .notification-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: #d32f2f;
        }
    </style>
</head>
<body>

    <!-- Navbar  -->
    <nav class="navbar">
       <a href="home.html" class="logo">ü•¶ FoodGuard</a>
       <ul class="nav-links">
            <li><a href="index.html" class="active">üè† Home</a></li>
            <li><a href="additems.html">‚ûï Add Item</a></li>
            <li><a href="allitems.html">üìã All Items</a></li>
            <li><a href="settings.html">‚öôÔ∏è Settings</a></li>
            <div style="cursor: pointer;" class="notification-bell" id="notificationBell">
                üîî <span class="notif-count" id="notif-count">0</span>
            </div>
       </ul>    
    </nav>

    <!-- Notification modal -->
    <div class="notification-modal" id="notificationModal">
        <div class="notification-modal-content">
            <div class="notification-modal-header">
                <h3>Expiring Soon Items</h3>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <div class="notification-list" id="notificationList">
                <p class="no-notifications">No items expiring soon. Your fridge is fresh!</p>
            </div>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h1>Keep Your Fridge Fresh</h1>
            <p>Track your food items and reduce waste with smart expiry alerts</p>
            <a href="additems.html" class="cta-button">Start Tracking</a>
        </div>
        <div class="hero-image">
            <img src="https://images.unsplash.com/photo-1584568694244-14fbdf83bd30?w=600&h=400&fit=crop" alt="Fresh vegetables in a fridge">
        </div>
    </section>

    <!-- Stats Section -->
    <section class="stats-section">
        <h2>Your Fridge Status</h2>
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-icon">üì¶</div>
                <div class="stat-number" id="total-items">0</div>
                <div class="stat-label">Total Items</div>
            </div>
            <div class="stat-card warning">
                <div class="stat-icon">‚è∞</div>
                <div class="stat-number" id="expiring-soon">0</div>
                <div class="stat-label">Expiring Soon</div>
            </div>
            <div class="stat-card danger">
                <div class="stat-icon">‚ùå</div>
                <div class="stat-number" id="expired-items">0</div>
                <div class="stat-label">Expired</div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2025 FoodGuard All rights reserved.</p>
    </footer>

    <script>
        const loggedInUser = localStorage.getItem('isLoggedIn');
        if (!loggedInUser) window.location.href = "index.html";

        // Update dashboard stats
        function updateDashboardCards() {
            const userData = JSON.parse(localStorage.getItem(loggedInUser)) || {};
            const items = userData.foods || [];
            const currentDate = new Date();
            let total = items.length, expiringSoon = 0, expired = 0;

            items.forEach(item => {
                const expiryDate = new Date(item.expiryDate);
                const daysDiff = (expiryDate - currentDate) / (1000 * 60 * 60 * 24);

                if (expiryDate < currentDate) expired++;
                else if (daysDiff <= 3) expiringSoon++;
            });

            document.getElementById('total-items').innerText = total;
            document.getElementById('expiring-soon').innerText = expiringSoon;
            document.getElementById('expired-items').innerText = expired;

            updateNotificationCount();
        }

        // Get expiring items ignoring dismissed ones
        function getExpiringItems() {
            const userData = JSON.parse(localStorage.getItem(loggedInUser)) || {};
            const items = userData.foods || [];
            const currentDate = new Date();
            const dismissed = JSON.parse(localStorage.getItem(loggedInUser + '_dismissed')) || [];
            const expiringItems = [];

            items.forEach(item => {
                const expiryDate = new Date(item.expiryDate);
                const daysDiff = (expiryDate - currentDate) / (1000 * 60 * 60 * 24);

                if (daysDiff > 0 && daysDiff <= 3 && !dismissed.includes(item.name)) {
                    expiringItems.push({...item, daysLeft: Math.ceil(daysDiff)});
                }
            });

            return expiringItems.sort((a, b) => a.daysLeft - b.daysLeft);
        }

        function updateNotificationCount() {
            const expiringItems = getExpiringItems();
            document.getElementById('notif-count').innerText = expiringItems.length;
        }

        function displayNotifications() {
            const expiringItems = getExpiringItems();
            const notificationList = document.getElementById('notificationList');

            if (expiringItems.length === 0) {
                notificationList.innerHTML = '<p class="no-notifications">No items expiring soon. Your fridge is fresh!</p>';
                return;
            }

            notificationList.innerHTML = expiringItems.map((item, index) => `
                <div class="notification-item">
                    <div class="notification-content">
                        <h4>${item.name}</h4>
                        <p class="notification-message">Eat this item before expiry!</p>
                        <p class="notification-date">Expires in ${item.daysLeft} day${item.daysLeft > 1 ? 's' : ''} (${new Date(item.expiryDate).toLocaleDateString()})</p>
                    </div>
                    <button class="notification-close" onclick="dismissNotification(${index})">&times;</button>
                </div>
            `).join('');
        }

        function dismissNotification(index) {
            const expiringItems = getExpiringItems();
            if (!expiringItems[index]) return;

            const dismissedKey = loggedInUser + '_dismissed';
            let dismissed = JSON.parse(localStorage.getItem(dismissedKey)) || [];
            dismissed.push(expiringItems[index].name);
            localStorage.setItem(dismissedKey, JSON.stringify(dismissed));

            displayNotifications(); // update modal
            updateNotificationCount();
        }

        document.getElementById('notificationBell').addEventListener('click', () => {
            document.getElementById('notificationModal').style.display = 'flex';
            displayNotifications();
        });

        document.getElementById('closeModal').addEventListener('click', () => {
            document.getElementById('notificationModal').style.display = 'none';
        });

        window.addEventListener('click', (event) => {
            const modal = document.getElementById('notificationModal');
            if (event.target === modal) modal.style.display = 'none';
        });

        // Load on page load
        window.onload = updateDashboardCards;
    </script>
</body>
</html>
