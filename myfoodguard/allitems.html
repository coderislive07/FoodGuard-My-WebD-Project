<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
        <link rel="stylesheet" href="index.css">
</head>
<body class ="all-items-body">
        <nav class="navbar">
                <a href = "index.html"> <div class="logo">ü•¶ FoodGuard</div></a>
            <div class="hamburger" id="hamburger">
        ‚ò∞
    </div>
            <ul class="nav-links">
                <li><a href="index.html" >üè† Home</a></li>
        <li><a href="additems.html">‚ûï Add Item</a></li>
        <li><a href="allitems.html" class="active">üìã All Items</a></li>
        <li><a href="settings.html">‚öôÔ∏è Settings</a></li>
            <div class="notification-bell" id="notificationBell">
        üîî
        <span class="notif-count">0</span>
    </div>
            </ul>
            
        </nav>
        <section class="all-items-section">
    <h1>All Food Items</h1>
    <div class="items-container" id="itemsContainer">
        <!-- Food items will be dynamically loaded here -->
   
    </div>  
    <!-- edit function modal box  -->
     <!-- Edit Item Dialog -->
<div id="editDialog" class="dialog" role="dialog" aria-modal="true" aria-labelledby="editDialogTitle">
  <div class="dialog-content">
    <h3>Edit Item</h3>
    <label for="editName">Item Name:</label>
    <input type="text" id="editName" />

    <label for="editQuantity">Quantity:</label>
    <input type="number" id="editQuantity" />

    <label for="editExpiry">Expiry Date:</label>
    <input type="date" id="editExpiry" />

    <label for="editCategory">Category:</label>
    <select id="editCategory">
        <option value="fruits">üçé Fruits</option>
        <option value="vegetables">ü•ï Vegetables</option>
        <option value="dairy">ü•õ Dairy</option>
        <option value="meat">üçó Meat</option>
        <option value="beverages">ü•§ Beverages</option>
        <option value="others">üçΩ Others</option>
    </select>

    <div class="dialog-buttons">
      <button id="saveEdit">Save</button>
      <button id="cancelEdit">Cancel</button>
    </div>
  </div>
</div>


</section>
    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>FoodGuard</h4>
                <p>Your smart companion for managing food and reducing waste.</p>
            </div>
            <div class="footer-section">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="add.html">Add Item</a></li>
                    <li><a href="items.html">All Items</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Contact</h4>
                <p>Email: info@FoodGuard.com</p>
                <p>Phone: +1 (555) 123-4567</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 FoodGuard All rights reserved.</p>
        </div>
    </footer>
<script>
           const loggedInUser = localStorage.getItem('isLoggedIn');
        if(!loggedInUser) {
        window.location.href = "index.html";
        }
    // delete function 
    function deleteItem(index)
    {
    let items = JSON.parse(localStorage.getItem('foodItems')) ;
    if(confirm("Are you sure that you want to delete this item?"))
    {
        items.splice(index ,1);
        localStorage.setItem('foodItems' , JSON.stringify(items));
        loadAllItems();
    }
    }
    // edit function : make a modal box in center of screen with prefilled data of the item to be edited , create a new div here 
    function editItem(index)
    {
        const dialog = document.getElementById('editDialog');
        const email = loggedInUser;
        const userData = JSON.parse(localStorage.getItem(email));
        const items = userData.foods;
        const item = items[index];
        document.getElementById('editName').value = item.name;
        document.getElementById('editQuantity').value = item.quantity;
        document.getElementById('editExpiry').value = item.expiryDate;
        document.getElementById('editCategory').value = item.category;
        dialog.style.display = 'flex';
        // Save button functionality
        document.getElementById('saveEdit').onclick = function() {
            item.name = document.getElementById('editName').value;
            item.quantity = document.getElementById('editQuantity').value;
            item.expiryDate = document.getElementById('editExpiry').value;
            item.category = document.getElementById('editCategory').value;
            localStorage.setItem(email, JSON.stringify(userData));
            alert("Item updated successfully!");
            dialog.style.display = 'none';
            loadAllItems();
        };
        // Cancel button functionality
        document.getElementById('cancelEdit').onclick = function() {
            dialog.style.display = 'none';
        };
    }

    // Function to load and display all food items
    function loadAllItems() {
        const itemsContainer = document.getElementById('itemsContainer');
        itemsContainer.innerHTML = '';
        const email = loggedInUser;
        const userData = JSON.parse(localStorage.getItem(email));
        const items = userData.foods;

        if (items.length === 0) {
            itemsContainer.innerHTML = '<p>No food items added yet.</p>';
            return;
        }

        items.forEach((item, index) => {
            const itemCard = document.createElement('div');
            itemCard.className = 'item-card';

            const expiryDate = new Date(item.expiryDate);
            const currentDate = new Date();
            let statusClass = '';
            if (expiryDate < currentDate) {
                statusClass = 'expired';
                // expiryDate-currentDate gives us milliseconds difference likes // 259200000 milliseconds 
            } else if ((expiryDate - currentDate) / (1000 * 60 * 60 * 24) <= 3) {
                statusClass = 'expiring-soon';
            } else {
                statusClass = 'fresh';
            }
            let dotClass = '';
let statusText = '';

if (statusClass === 'fresh') {
    dotClass = 'fresh-dot';
    statusText = 'Fresh';
} else if (statusClass === 'expiring-soon') {
    dotClass = 'expiring-soon-dot';
    statusText = 'Expiring Soon';
} else {
    dotClass = 'expired-dot';
    statusText = 'Expired';
}



           itemCard.innerHTML = `
    <h3>${item.name}</h3>
    <p>Category: ${item.category}</p>
    <p>Quantity: ${item.quantity}</p>
    <p>Expiry Date: ${item.expiryDate}</p>
    <p><span class="status-dot ${dotClass}"></span>${statusText}</p>
    <p>Notes: ${item.notes || 'N/A'}</p>
    <button onclick="editItem(${index})">Edit</button>
    <button onclick="deleteItem(${index})">Delete</button>
`;
            itemsContainer.appendChild(itemCard);
        });
    }
    window.onload = loadAllItems;
  


    </script>
</body>
</html>